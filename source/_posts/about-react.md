---
title: å…³äºReactË™â°™Ë™
date: 2020-01-07 15:19:08
tags:
---
Ë™â°™Ë™æœ€è¿‘çš„å·¥ä½œä¸€ç›´åœ¨ä½¿ç”¨Reactï¼Œå·²ç»å·®ä¸å¤šäº”ä¸ªæœˆäº†ï¼Œæƒ³ç»™è‡ªå·±å†™äº›å¯¹reactçš„ä¸€äº›æ€è€ƒå’Œæ€»ç»“ã€‚ä¹Ÿè®°å½•ä¸€ä¸‹å½“åˆåˆšä¸Šæ‰‹æ—¶çš„ç–‘æƒ‘ï¼Œæ–¹ä¾¿åç»­è‡ªå·±å›é¡¾ã€‚
ç½‘ä¸Šå„ç§è¨€è®ºè¯´ React ä¸Šæ‰‹æ¯” Vue éš¾ï¼Œå¯èƒ½éš¾å°±éš¾ä¸èƒ½æ·±åˆ»ç†è§£ JSXï¼Œæˆ–è€…å¯¹ ES6 çš„ä¸€äº›ç‰¹æ€§ç†è§£å¾—ä¸å¤Ÿæ·±åˆ»ï¼Œå¯¼è‡´è§‰å¾—æœ‰äº›ç‚¹éš¾ä»¥ç†è§£ï¼Œç„¶åè¯´ React æ¯”è¾ƒéš¾ä¸Šæ‰‹ï¼Œè¿˜åäººç±»å•¥çš„ï¼Œæ€€æ£ç€æ•¬ç•ä¹‹å¿ƒï¼Œå‘ç°å…¶å®ä¹Ÿæ²¡é‚£ä¹ˆçš„å¤æ‚å˜›...
<!-- more -->
#### ä¸ºä»€ä¹ˆè¦å¼•å…¥ React
åœ¨å†™ React çš„æ—¶å€™ï¼Œä½ å¯èƒ½ä¼šå†™ç±»ä¼¼è¿™æ ·çš„ä»£ç ï¼š
```js
import React from 'react'

function A() {
  // ...other code
  return <h1>æˆ‘æ˜¯ä¸€é¢—å°æ¾çƒË™â°™Ë™</h1>
}
```
å¤´ä¸€æ¬¡æ¥è§¦çš„æ—¶å€™è‚¯å®šç–‘æƒ‘è¿‡ï¼Œä¸‹é¢çš„ä»£ç éƒ½æ²¡æœ‰ç”¨åˆ° Reactï¼Œä¸ºä»€ä¹ˆè¦å¼•å…¥ React å‘¢ï¼Ÿ

å¦‚æœä½ æŠŠ import React from â€˜reactâ€™ åˆ æ‰ï¼Œè¿˜ä¼šæŠ¥ä¸‹é¢è¿™æ ·çš„é”™è¯¯ï¼š
![img](1.jpg)
é‚£ä¹ˆç©¶ç«Ÿæ˜¯å“ªé‡Œç”¨åˆ°äº†è¿™ä¸ª Reactï¼Œå¯¼è‡´æˆ‘ä»¬å¼•å…¥ React ä¼šæŠ¥é”™å‘¢ï¼Œä¸æ‡‚è¿™ä¸ªåŸå› ï¼Œé‚£ä¹ˆå°±æ˜¯ JSX æ²¡æœ‰æå¾—å¤ªæ˜ç™½ã€‚

ä½ å¯ä»¥è®²ä¸Šé¢çš„ä»£ç (å¿½ç•¥å¯¼å…¥è¯­å¥)æ”¾åˆ°åœ¨çº¿ babel é‡Œè¿›è¡Œè½¬åŒ–ä¸€ä¸‹ï¼Œå‘ç° babel ä¼šæŠŠä¸Šé¢çš„ä»£ç è½¬åŒ–æˆ:
```js
function A() {
  // ...other code
  return React.createElement("h1", null, "æˆ‘æ˜¯ä¸€é¢—å°æ¾çƒË™â°™Ë™");
}
```
å› ä¸ºä»æœ¬è´¨ä¸Šè®²ï¼ŒJSX åªæ˜¯ä¸º `React.createElement(component, props, ...children)` å‡½æ•°æä¾›çš„è¯­æ³•ç³–ã€‚

#### ä¸ºä»€ä¹ˆè¦ç”¨ `className` è€Œä¸ç”¨ `class`
- è®¾è®¡ç†å¿µ
è¿™ä¸ªå…¶å®æ˜¯å› ä¸ºReact ä¸€å¼€å§‹çš„ç†å¿µæ˜¯æƒ³ä¸æµè§ˆå™¨çš„ DOM API ä¿æŒä¸€ç›´è€Œä¸æ˜¯ HTMLï¼Œå› ä¸º JSX æ˜¯ JS çš„æ‰©å±•ï¼Œè€Œä¸æ˜¯ç”¨æ¥ä»£æ›¿ HTML çš„ï¼Œè¿™æ ·ä¼šå’Œå…ƒç´ çš„åˆ›å»ºæ›´ä¸ºæ¥è¿‘ã€‚åœ¨å…ƒç´ ä¸Šè®¾ç½® class éœ€è¦ä½¿ç”¨ className è¿™ä¸ª APIï¼š
```js
const element = document.createElement("div")
element.className = "hello" 
```
- å…³é”®å­—ä¸æ”¯æŒ
æµè§ˆå™¨é—®é¢˜ï¼ŒES5 ä¹‹å‰ï¼Œåœ¨å¯¹è±¡ä¸­ä¸èƒ½ä½¿ç”¨ä¿ç•™å­—ã€‚ä»¥ä¸‹ä»£ç åœ¨ IE8 ä¸­å°†ä¼šæŠ›å‡ºé”™è¯¯ï¼š
```js
const element = {
 attributes: {
   class: "hello"
 }
}
```
è§£æ„é—®é¢˜ï¼Œå½“ä½ åœ¨è§£æ„å±æ€§çš„æ—¶å€™ï¼Œå¦‚æœåˆ†é…ä¸€ä¸ª class å˜é‡ä¼šå‡ºé—®é¢˜ï¼š
```js
const { class } = { class: 'foo' } // Uncaught SyntaxError: Unexpected token }
const { className } = { className: 'foo' } 
const { class: className } = { class: 'foo' } 
```
å…¶ä»–è®¨è®ºå¯ç»§ç»­æ·±åº¦æœç´¢ï¼šã€æœ‰è¶£çš„è¯é¢˜ï¼Œä¸ºä»€ä¹ˆjsxç”¨classNameè€Œä¸æ˜¯classã€

#### ä¸ºä»€ä¹ˆå±æ€§è¦ç”¨å°é©¼å³°


>å› ä¸º JSX è¯­æ³•ä¸Šæ›´æ¥è¿‘ JavaScript è€Œä¸æ˜¯ HTMLï¼Œæ‰€ä»¥ React DOM ä½¿ç”¨ camelCaseï¼ˆå°é©¼å³°å‘½åï¼‰æ¥å®šä¹‰å±æ€§çš„åç§°ï¼Œè€Œä¸ä½¿ç”¨ HTML å±æ€§åç§°çš„å‘½åçº¦å®šã€‚
<cite>[æ¥è‡ª JSX ç®€ä»‹](https://react.docschina.org/docs/introducing-jsx.html)</cite>

#### ä¸ºä»€ä¹ˆ constructor é‡Œè¦è°ƒç”¨ super å’Œä¼ é€’ props

è¿™æ˜¯å®˜ç½‘çš„ä¸€æ®µä»£ç ï¼Œå…·ä½“è§ï¼š[çŠ¶æ€(State) å’Œ ç”Ÿå‘½å‘¨æœŸ](https://react.docschina.org/docs/state-and-lifecycle.html)

```js
class Clock extends React.Component {
  constructor(props) {
    super(props);// Ë™â°™Ë™å’©å•Šï¼Ÿ
    this.state = {date: new Date()};
  }

  render() {
    return (
      <div>
        <h1>Hello, world!</h1>
        <h2>It is {this.state.date.toLocaleTimeString()}.</h2>
      </div>
    );
  }
}
```
è€Œä¸”æœ‰è¿™ä¹ˆä¸€æ®µè¯ï¼Œä¸ä»…è®©æˆ‘ä»¬è°ƒç”¨ super è¿˜è¦æŠŠ props ä¼ é€’è¿›å»ï¼Œä½†æ˜¯æ²¡æœ‰å‘Šè¯‰æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšã€‚
ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰ç–‘æƒ‘è¿‡ä¸ºä»€ä¹ˆè¦è°ƒç”¨ super å’Œä¼ é€’ propsï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥è§£å¼€è°œé¢˜å§ã€‚

##### ä¸ºä»€ä¹ˆè¦è°ƒç”¨ `super`

å…¶å®è¿™ä¸æ˜¯ React çš„é™åˆ¶ï¼Œè¿™æ˜¯ JavaScript çš„é™åˆ¶ï¼Œåœ¨æ„é€ å‡½æ•°é‡Œå¦‚æœè¦è°ƒç”¨ `this`ï¼Œé‚£ä¹ˆæå‰å°±è¦è°ƒç”¨ superï¼Œåœ¨ React é‡Œï¼Œæˆ‘ä»¬å¸¸å¸¸ä¼šåœ¨æ„é€ å‡½æ•°é‡Œåˆå§‹åŒ– `stateï¼Œthis.state = xxx` ï¼Œæ‰€ä»¥éœ€è¦è°ƒç”¨ `super`ã€‚

##### ä¸ºä»€ä¹ˆè¦ä¼ é€’ props`

ä½ å¯èƒ½ä»¥ä¸ºå¿…é¡»ç»™ `super` ä¼ å…¥ `props`ï¼Œå¦åˆ™ `React.Component` å°±æ²¡æ³•åˆå§‹åŒ– `this.props`ï¼š

```js
class Component {
  constructor(props) {
    this.props = props;
    // ...
  }
}
```
ä¸è¿‡ï¼Œå¦‚æœä½ ä¸å°å¿ƒæ¼ä¼ äº† propsï¼Œç›´æ¥è°ƒç”¨äº† super()ï¼Œä½ ä»ç„¶å¯ä»¥åœ¨ render å’Œå…¶ä»–æ–¹æ³•ä¸­è®¿é—® this.propsï¼ˆä¸ä¿¡çš„è¯å¯ä»¥è¯•è¯•å˜›Ë™â°™Ë™ï¼‰ã€‚

ä¸ºå•¥è¿™æ ·ä¹Ÿè¡Œï¼Ÿå› ä¸ºReact ä¼šåœ¨æ„é€ å‡½æ•°è¢«è°ƒç”¨ä¹‹åï¼Œä¼šæŠŠ props èµ‹å€¼ç»™åˆšåˆšåˆ›å»ºçš„å®ä¾‹å¯¹è±¡ï¼š
```js
const instance = new YourComponent(props);
instance.props = props;
```
`props` æ‰€ä»¥è¯´ä¸ä¼ ä¹Ÿèƒ½ç”¨ï¼Œæ˜¯æœ‰åŸå› çš„ã€‚

ä½†è¿™æ„å‘³ç€ä½ åœ¨ä½¿ç”¨ React æ—¶ï¼Œå¯ä»¥ç”¨ `super()` ä»£æ›¿ `super(props)` äº†ä¹ˆï¼Ÿ

é‚£è¿˜æ˜¯ä¸è¡Œçš„ï¼Œä¸ç„¶å®˜ç½‘ä¹Ÿä¸ä¼šå»ºè®®ä½ è°ƒç”¨ `props` äº†ï¼Œè™½ç„¶ React ä¼šåœ¨æ„é€ å‡½æ•°è¿è¡Œä¹‹åï¼Œä¸º `this.props` èµ‹å€¼ï¼Œä½†åœ¨ `super()` è°ƒç”¨ä¹‹åä¸æ„é€ å‡½æ•°ç»“æŸä¹‹å‰ï¼Œ `this.props` ä»ç„¶æ˜¯æ²¡æ³•ç”¨çš„ã€‚

```js
// Inside React
class Component {
  constructor(props) {
    this.props = props;
    // ...
  }
}

// Inside your code
class Button extends React.Component {
  constructor(props) {
    super(); // ğŸ˜¬ å¿˜äº†ä¼ å…¥ props
    console.log(props); // âœ… {}
    console.log(this.props); // ğŸ˜¬ undefined
  }
  // ...
}
```
è¦æ˜¯æ„é€ å‡½æ•°ä¸­è°ƒç”¨äº†æŸä¸ªè®¿é—® `props`çš„æ–¹æ³•ï¼Œé‚£è¿™ä¸ª bug å°±æ›´éš¾å®šä½äº†ã€‚å› æ­¤å¼ºçƒˆå»ºè®®å§‹ç»ˆä½¿ç”¨`super(props)`ï¼Œå³ä½¿è¿™ä¸æ˜¯å¿…é¡»çš„ï¼š

```js
class Button extends React.Component {
  constructor(props) {
    super(props); // âœ… We passed props
    console.log(props); // âœ… {}
    console.log(this.props); // âœ… {}
  }
  // ...
}
```
ä¸Šé¢çš„ä»£ç ç¡®ä¿ `this.props` å§‹ç»ˆæ˜¯æœ‰å€¼çš„ã€‚

å¦‚æœä½ æƒ³é¿å…ä»¥ä¸Šçš„é—®é¢˜ï¼Œä½ å¯ä»¥é€šè¿‡`class`å±æ€§ææ¡ˆ æ¥ç®€åŒ–ä»£ç ï¼š

```js
class Clock extends React.Component {
  state = {date: new Date()};

  render() {
    return (
      <div>
        <h1>Hello, world!</h1>
        <h2>It is {this.state.date.toLocaleTimeString()}.</h2>
      </div>
    );
  }
}
```

#### ä¸ºä»€ä¹ˆç»„ä»¶ç”¨å¤§å†™å¼€å¤´

å‰é¢ä»¥åŠè¯´è¿‡äº†ï¼ŒJSX æ˜¯ä¸º `React.createElement(component, props, â€¦children)` æä¾›çš„è¯­æ³•ç³–ï¼Œcomponent çš„ç±»å‹æ˜¯ï¼šstring/ReactClass typeï¼Œæˆ‘ä»¬å…·ä½“çœ‹ä¸€ä¸‹åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šç”¨åˆ° string ç±»å‹ï¼Œä»€ä¹ˆæƒ…å†µä¸‹ç”¨åˆ° ReactClass type ç±»å‹
- string ç±»å‹reactä¼šè§‰å¾—ä»–æ˜¯ä¸€ä¸ªåŸç”ŸdomèŠ‚ç‚¹
- ReactClass type ç±»å‹ è‡ªå®šä¹‰ç»„ä»¶

ä¾‹å¦‚ï¼ˆstringï¼‰ï¼šåœ¨ jsx ä¸­æˆ‘ä»¬å†™ä¸€ä¸ª
```html
<div></div>
```
è½¬æ¢ä¸ºjsçš„æ—¶å€™å°±å˜æˆäº†

```js
React.createElement("div", null)
```
ä¾‹å¦‚ï¼ˆReactClass typeï¼‰ï¼šåœ¨jsxä¸­æˆ‘ä»¬å†™ä¸€ä¸ª

```js
function MyDiv() {
    return (<div><div>)
}
<MyDiv></MyDiv>
```
è½¬æ¢ä¸ºjsçš„æ—¶å€™å°±å˜æˆäº†
```js
function MyDiv() {
  return React.createElement("div", null);
}

React.createElement(MyDiv, null);
```
ä¸Šè¾¹çš„ä¾‹å­ä¸­å¦‚æœå°†MyDivä¸­çš„é¦–å­—æ¯å°å†™ï¼Œå¦‚ä¸‹

```js
function myDiv() {
    return (<div><div>)
}
<myDiv></myDiv>
```
è½¬æ¢ä¸º js çš„æ—¶å€™å°±å˜æˆäº†

```js
function MyDiv() {
  return React.createElement("div", null);
}

React.createElement("myDiv", null);
```
ç”±äºæ‰¾ä¸åˆ° myDiv è¿™ä¸ª domï¼Œæ‰€ä»¥å°±ä¼šæŠ¥é”™ã€‚

#### ä¸ºä»€ä¹ˆè°ƒç”¨æ–¹æ³•è¦ `bind this`

**é¦–å…ˆï¼Œä½ éœ€è¦æ·±åˆ»çš„ç†è§£ JavaScript ä¸­çš„ `this`**

ç›¸ä¿¡åˆšå†™ React çš„æ—¶å€™ï¼Œå¾ˆå¤šæœ‹å‹å¯èƒ½ä¼šå†™ç±»ä¼¼è¿™æ ·çš„ä»£ç ï¼š

```js
class Foo extends React.Component {
  handleClick () {
    this.setState({ xxx: aaa })
  }

  render() {
    return (
      <button onClick={this.handleClick}>
        Click me
      </button>
    )
  }
}
```
å‘ç°ä¼šæŠ¥ `this` æ˜¯ `undefined` çš„é”™ï¼Œç„¶åå¯èƒ½å¯¹äº‹ä»¶å¤„ç†æ¯”è¾ƒç–‘æƒ‘ï¼Œç„¶åå»çœ‹å®˜ç½‘çš„äº‹ä»¶å¤„ç†æœ‰ä¸‹é¢ä¸€æ®µè¯ï¼š

ä½ å¿…é¡»è°¨æ…å¯¹å¾… JSX å›è°ƒå‡½æ•°ä¸­çš„ `this`ï¼Œåœ¨ JavaScript ä¸­ï¼Œclass çš„æ–¹æ³•é»˜è®¤ä¸ä¼šç»‘å®š`this`ã€‚å¦‚æœä½ å¿˜è®°ç»‘å®š `this.handleClick` å¹¶æŠŠå®ƒä¼ å…¥äº† `onClick`ï¼Œå½“ä½ è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„æ—¶å€™ `this` çš„å€¼ä¸º `undefined`ã€‚
è¿™å¹¶ä¸æ˜¯ React ç‰¹æœ‰çš„è¡Œä¸ºï¼›è¿™å…¶å®ä¸ JavaScript å‡½æ•°å·¥ä½œåŸç†æœ‰å…³ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœä½ æ²¡æœ‰åœ¨æ–¹æ³•åé¢æ·»åŠ  `()`ï¼Œä¾‹å¦‚ `onClick={this.handleClick}`ï¼Œä½ åº”è¯¥ä¸ºè¿™ä¸ªæ–¹æ³•ç»‘å®š `this`ã€‚
ç„¶åä½ çœ‹äº†å®˜ç½‘çš„ä¾‹å­å’Œå»ºè®®ä¹‹åï¼ŒçŸ¥é“éœ€è¦ä¸ºäº‹ä»¶å¤„ç†å‡½æ•°ç»‘å®š `this` å°±èƒ½è§£å†³ï¼Œåƒä¸‹é¢è¿™æ ·ï¼š

```js
class Foo extends React.Component {
  handleClick () {
    this.setState({ xxx: aaa })
  }

  render() {
    return (
      <button onClick={this.handleClick.bind(this)}>
        Click me
      </button>
    )
  }
}
```
ä½†æ˜¯å¯èƒ½ä½ æ²¡æœ‰å»æ€è€ƒè¿‡ä¸ºä»€ä¹ˆéœ€è¦ `bind this`ï¼Ÿå¦‚æœä½ ä¸èƒ½ç†è§£çš„è¯ï¼Œé‚£å°±è¿˜æ˜¯ js çš„åŸºç¡€æ²¡æœ‰æ‰“å¥½ã€‚

##### React æ˜¯å¦‚ä½•å¤„ç†äº‹ä»¶çš„ï¼Ÿ

å’±ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ React æ˜¯å¦‚ä½•å¤„ç†äº‹ä»¶çš„ã€‚

React çš„äº‹ä»¶æ˜¯åˆæˆäº‹ä»¶ï¼Œ å†…éƒ¨åŸç†éå¸¸å¤æ‚ï¼Œè¿™é‡ŒåªæŠŠå…³é”®æ€§ï¼Œå¯ä»¥ç”¨æ¥è§£ç­”è¿™ä¸ªé—®é¢˜çš„åŸç†éƒ¨åˆ†è¿›è¡Œä»‹ç»

ä¸Šç¯‡å·²ç»è¯´è¿‡ï¼Œjsx å®é™…ä¸Šæ˜¯ `React.createElement(component, props, â€¦children)` å‡½æ•°æä¾›çš„è¯­æ³•ç³–ï¼Œé‚£ä¹ˆè¿™æ®µ jsx ä»£ç ï¼š

```jsx
 <button onClick={this.handleClick}>
    Click me
 </button>
```
ä¼šè¢«è½¬åŒ–ä¸ºï¼š

```js
React.createElement("button", {
    onClick: this.handleClick
}, "Click me")
```
äº†è§£äº†ä¸Šé¢çš„ï¼Œç„¶åç®€å•çš„ç†è§£ react å¦‚ä½•å¤„ç†äº‹ä»¶çš„ï¼ŒReact åœ¨ç»„ä»¶åŠ è½½(mount)å’Œæ›´æ–°(update)æ—¶ï¼Œå°†äº‹ä»¶é€šè¿‡ `addEventListener`  ç»Ÿä¸€æ³¨å†Œåˆ° `document ä¸Š`ï¼Œç„¶åä¼šæœ‰ä¸€ä¸ªäº‹ä»¶æ± å­˜å‚¨äº†æ‰€æœ‰çš„äº‹ä»¶ï¼Œå½“äº‹ä»¶è§¦å‘çš„æ—¶å€™ï¼Œé€šè¿‡ `dispatchEvent` è¿›è¡Œäº‹ä»¶åˆ†å‘ã€‚

æ‰€ä»¥ä½ å¯ä»¥ç®€å•çš„ç†è§£ä¸ºï¼Œæœ€ç»ˆ `this.handleClick` ä¼šä½œä¸ºä¸€ä¸ªå›è°ƒå‡½æ•°è°ƒç”¨ã€‚

ç†è§£äº†è¿™ä¸ªï¼Œç„¶åå†æ¥çœ‹çœ‹å›è°ƒå‡½æ•°ä¸ºä»€ä¹ˆå°±ä¼šä¸¢å¤± `this`ã€‚

##### `this` ç®€å•å›é¡¾

> åœ¨å‡½æ•°å†…éƒ¨ï¼Œ`this`çš„å€¼å–å†³äºå‡½æ•°è¢«è°ƒç”¨çš„æ–¹å¼ã€‚

é€šè¿‡ä¸Šé¢å¯¹äº‹ä»¶å¤„ç†çš„ä»‹ç»ï¼Œæ¥æ¨¡æ‹Ÿä¸€ä¸‹åœ¨ç±»ç»„ä»¶çš„ render å‡½æ•°ä¸­ï¼Œ æœ‰ç‚¹ç±»ä¼¼äºåšäº†è¿™æ ·çš„æ“ä½œ:

```js
class Foo {
    sayThis () {
        console.log(this); // è¿™é‡Œçš„ `this` æŒ‡å‘è°ï¼Ÿ
    }
    exec (cb) {
        cb();
    }
    render () {
        this.exec(this.sayThis);
    }
}

var foo = new Foo();
foo.render(); // è¾“å‡ºç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ
```
ä½ ä¼šå‘ç°æœ€ç»ˆç»“æœè¾“å‡ºçš„æ˜¯ `undefined`ï¼Œé‚£ä¹ˆæˆ‘è§‰å¾—ä½ ä¹Ÿå¯ä»¥ç†è§£ä¸ºä»€ä¹ˆéœ€è¦ `bind this` äº†ã€‚ï¼ˆå°±æ˜¯cbè°ƒç”¨çš„æ—¶å€™ï¼ŒæŠŠthisæä¸¢æƒ¹Ë™â°™Ë™ï¼‰

é‚£ä¹ˆä½ å¯èƒ½ä¼šé—®ï¼šä¸ºä»€ä¹ˆReactæ²¡æœ‰è‡ªåŠ¨çš„æŠŠ `bind` é›†æˆåˆ° `render` æ–¹æ³•ä¸­å‘¢?åœ¨ `exec` è°ƒç”¨å›è°ƒçš„æ—¶å€™ç»‘å®šè¿›å»ï¼Œåƒè¿™æ ·ï¼š

```js
class Foo {
    sayThis () {
        console.log(this); // è¿™é‡Œçš„ `this` æŒ‡å‘è°ï¼Ÿ
    }
    exec (cb) {
        cb().bind(this);
    }
    render () {
        this.exec(this.sayThis);
    }
}

var foo = new Foo();
foo.render(); // è¾“å‡ºç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ
```
**å› ä¸º `render` å¤šæ¬¡è°ƒç”¨æ¯æ¬¡éƒ½è¦ `bind` ä¼šå½±å“æ€§èƒ½ï¼Œæ‰€ä»¥å®˜æ–¹å»ºè®®ä½ è‡ªå·±åœ¨ `constructor` ä¸­æ‰‹åŠ¨ `bind` è¾¾åˆ°æ€§èƒ½ä¼˜åŒ–ã€‚**

##### å››ç§äº‹ä»¶å¤„ç†å¯¹æ¯”

å¯¹äºäº‹ä»¶å¤„ç†çš„å†™æ³•ä¹Ÿæœ‰å¥½å‡ ç§ï¼Œå’±ä»¬æ¥è¿›è¡Œå¯¹æ¯”ä¸€ä¸‹ï¼š

1. ç›´æ¥ bind this å‹
å°±æ˜¯åƒæ–‡ç« å¼€å§‹çš„é‚£æ ·ï¼Œç›´æ¥åœ¨äº‹ä»¶é‚£é‡Œ bind this
```js
class Foo extends React.Component {
  handleClick () {
    this.setState({ xxx: aaa })
  }

  render() {
    return (
      <button onClick={this.handleClick.bind(this)}>
        Click me
      </button>
    )
  }
}
```
**ä¼˜ç‚¹**ï¼šå†™èµ·æ¥é¡ºæ‰‹ï¼Œä¸€å£æ°”å°±èƒ½æŠŠè¿™ä¸ªé€»è¾‘å†™å®Œï¼Œä¸ç”¨ç§»åŠ¨å…‰æ ‡åˆ°å…¶ä»–åœ°æ–¹ã€‚
**ç¼ºç‚¹**ï¼šæ€§èƒ½ä¸å¤ªå¥½ï¼Œè¿™ç§æ–¹å¼è·Ÿ react å†…éƒ¨å¸®ä½  bind ä¸€æ ·çš„ï¼Œæ¯æ¬¡ render éƒ½ä¼šè¿›è¡Œ bindï¼Œè€Œä¸”å¦‚æœæœ‰ä¸¤ä¸ªå…ƒç´ çš„äº‹ä»¶å¤„ç†å‡½æ•°å¼åŒä¸€ä¸ªï¼Œä¹Ÿè¿˜æ˜¯è¦è¿›è¡Œ bindï¼Œè¿™æ ·ä¼šå¤šå†™ç‚¹ä»£ç ï¼Œè€Œä¸”è¿›è¡Œä¸¤æ¬¡ bindï¼Œæ€§èƒ½ä¸æ˜¯å¤ªå¥½ã€‚(ä¸è¿‡å…¶å®è¿™ç‚¹æ€§èƒ½å¾€å¾€ä¸ä¼šæ˜¯æ€§èƒ½ç“¶é¢ˆçš„åœ°æ–¹ï¼Œå¦‚æœä½ è§‰å¾—é¡ºæ‰‹ï¼Œè¿™æ ·å†™å®Œå…¨æ²¡é—®é¢˜)

2. constuctor æ‰‹åŠ¨ bind å‹
```js
class Foo extends React.Component {
  constuctor(props) {
    super(props)
    this.handleClick = this.handleClick.bind(this)
  }
  handleClick () {
    this.setState({ xxx: aaa })
  }

  render() {
    return (
      <button onClick={this.handleClick}>
        Click me
      </button>
    )
  }
}
```
**ä¼˜ç‚¹**ï¼šç›¸æ¯”äºç¬¬ä¸€ç§æ€§èƒ½æ›´å¥½ï¼Œå› ä¸ºæ„é€ å‡½æ•°åªæ‰§è¡Œä¸€æ¬¡ï¼Œé‚£ä¹ˆåªä¼š bind ä¸€æ¬¡ï¼Œè€Œä¸”å¦‚æœæœ‰å¤šä¸ªå…ƒç´ éƒ½éœ€è¦è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œä¹Ÿä¸éœ€è¦é‡å¤ bindï¼ŒåŸºæœ¬ä¸Šè§£å†³äº†ç¬¬ä¸€ç§çš„ä¸¤ä¸ªç¼ºç‚¹ã€‚
**ç¼ºç‚¹**ï¼šæ²¡æœ‰æ˜æ˜¾ç¼ºç‚¹ï¼Œç¡¬è¦è¯´çš„è¯å°±æ˜¯å¤ªä¸‘äº†ï¼Œç„¶åä¸é¡ºæ‰‹ã€‚

3. ç®­å¤´å‡½æ•°å‹
```js
class Foo extends React.Component {
  handleClick () {
    this.setState({ xxx: aaa })
  }

  render() {
    return (
      <button onClick={(e) => this.handleClick(e)}>
        Click me
      </button>
    )
  }
}
```
**ä¼˜ç‚¹**ï¼šé¡ºæ‰‹ï¼Œå¥½çœ‹ã€‚
**ç¼ºç‚¹**ï¼šæ¯æ¬¡ render éƒ½ä¼šé‡å¤åˆ›å»ºå‡½æ•°ï¼Œæ€§èƒ½ä¼šå·®ä¸€ç‚¹ã€‚

4. public class fields å‹
è¿™ç§ class fieldsè¿˜å¤„äºå®éªŒé˜¶æ®µï¼Œè²Œä¼¼ç›®å‰è¿˜æ²¡æœ‰è¢«çº³å…¥æ ‡å‡†
```js
class Foo extends React.Component {
  handleClick = () => {
    this.setState({ xxx: aaa })
  }

  render() {
    return (
      <button onClick={this.handleClick}>
        Click me
      </button>
    )
  }
}
```
**ä¼˜ç‚¹**ï¼šå¥½çœ‹ï¼Œæ€§èƒ½å¥½ã€‚
**ç¼ºç‚¹**ï¼šæ²¡æœ‰æ˜æ˜¾ç¼ºç‚¹ï¼Œå¦‚æœç¡¬è¦è¯´å¯èƒ½å°±æ˜¯è¦å¤šè£…ä¸€ä¸ª babel æ’ä»¶æ¥æ”¯æŒè¿™ç§è¯­æ³•ã€‚

#### ä¸ºä»€ä¹ˆè¦ `setState`ï¼Œè€Œä¸æ˜¯ç›´æ¥ `this.state.xx = oo`

å¦‚æœä» vue è½¬åˆ° React å¯èƒ½ä¼šæœ‰è¿™ç§ç–‘é—®ï¼Œå› ä¸º vue ä¿®æ”¹çŠ¶æ€éƒ½æ˜¯ç›´æ¥æ”¹çš„ã€‚

å¦‚æœæˆ‘ä»¬äº†è§£ `setState`çš„åŸç†çš„è¯ï¼Œå¯èƒ½å°±èƒ½è§£ç­”è¿™ä¸ªé—®é¢˜äº†ï¼Œ`setState` åšçš„äº‹æƒ…ä¸ä»…ä»…åªæ˜¯ä¿®æ”¹äº† `this.state` çš„å€¼ï¼Œå¦å¤–æœ€é‡è¦çš„æ˜¯å®ƒä¼šè§¦å‘ React çš„æ›´æ–°æœºåˆ¶ï¼Œä¼šè¿›è¡Œ diff ï¼Œç„¶åå°† patch éƒ¨åˆ†æ›´æ–°åˆ°çœŸå® dom é‡Œã€‚

å¦‚æœä½ ç›´æ¥ `this.state.xx == oo` çš„è¯ï¼Œ`state` çš„å€¼ç¡®å®ä¼šæ”¹ï¼Œä½†æ˜¯æ”¹äº†ä¸ä¼šè§¦å‘ UI çš„æ›´æ–°ï¼Œé‚£å°±ä¸æ˜¯æ•°æ®é©±åŠ¨äº†ã€‚

é‚£ä¸ºä»€ä¹ˆ Vue ç›´æ¥ä¿®æ”¹ `data` å¯ä»¥è§¦å‘ UI çš„æ›´æ–°å‘¢ï¼Ÿå› ä¸º Vue åœ¨åˆ›å»º UI çš„æ—¶å€™ä¼šæŠŠè¿™äº› `data` ç»™æ”¶é›†èµ·æ¥ï¼Œå¹¶ä¸”åœ¨è¿™äº› `data` çš„è®¿é—®å™¨å±æ€§ `setter` è¿›è¡Œäº†é‡å†™ï¼Œåœ¨è¿™ä¸ªé‡å†™çš„æ–¹æ³•é‡Œä¼šå»è§¦å‘ UI çš„æ›´æ–°ã€‚

#### `setState` æ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥ç›¸å…³é—®é¢˜

1. `setState` æ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥ï¼Ÿ
æˆ‘çš„å›ç­”æ˜¯æ‰§è¡Œè¿‡ç¨‹ä»£ç åŒæ­¥çš„ï¼Œåªæ˜¯åˆæˆäº‹ä»¶å’Œé’©å­å‡½æ•°çš„è°ƒç”¨é¡ºåºåœ¨æ›´æ–°ä¹‹å‰ï¼Œå¯¼è‡´åœ¨åˆæˆäº‹ä»¶å’Œé’©å­å‡½æ•°ä¸­æ²¡æ³•ç«‹é©¬æ‹¿åˆ°æ›´æ–°åçš„å€¼ï¼Œå½¢å¼äº†æ‰€è°“çš„â€œå¼‚æ­¥â€ï¼Œæ‰€ä»¥è¡¨ç°å‡ºæ¥æœ‰æ—¶æ˜¯åŒæ­¥ï¼Œæœ‰æ—¶æ˜¯â€œå¼‚æ­¥â€ã€‚

2. ä½•æ—¶æ˜¯åŒæ­¥ï¼Œä½•æ—¶æ˜¯å¼‚æ­¥å‘¢ï¼Ÿ
åªåœ¨åˆæˆäº‹ä»¶å’Œé’©å­å‡½æ•°ä¸­æ˜¯â€œå¼‚æ­¥â€çš„ï¼Œåœ¨åŸç”Ÿäº‹ä»¶å’Œ `setTimeout/setInterval` ç­‰åŸç”Ÿ API ä¸­éƒ½æ˜¯åŒæ­¥çš„ã€‚ç®€å•çš„å¯ä»¥ç†è§£ä¸ºè¢« React æ§åˆ¶çš„å‡½æ•°é‡Œé¢å°±ä¼šè¡¨ç°å‡ºâ€œå¼‚æ­¥â€ï¼Œåä¹‹è¡¨ç°ä¸ºåŒæ­¥ã€‚

3. é‚£ä¸ºä»€ä¹ˆä¼šå‡ºç°å¼‚æ­¥çš„æƒ…å†µå‘¢ï¼Ÿ
ä¸ºäº†åšæ€§èƒ½ä¼˜åŒ–ï¼Œå°† `state` çš„æ›´æ–°å»¶ç¼“åˆ°æœ€åæ‰¹é‡åˆå¹¶å†å»æ¸²æŸ“å¯¹äºåº”ç”¨çš„æ€§èƒ½ä¼˜åŒ–æ˜¯æœ‰æå¤§å¥½å¤„çš„ï¼Œå¦‚æœæ¯æ¬¡çš„çŠ¶æ€æ”¹å˜éƒ½å»é‡æ–°æ¸²æŸ“çœŸå® domï¼Œé‚£ä¹ˆå®ƒå°†å¸¦æ¥å·¨å¤§çš„æ€§èƒ½æ¶ˆè€—ã€‚

4. é‚£å¦‚ä½•åœ¨è¡¨ç°å‡ºå¼‚æ­¥çš„å‡½æ•°é‡Œå¯ä»¥å‡†ç¡®æ‹¿åˆ°æ›´æ–°åçš„ `state` å‘¢ï¼Ÿ
é€šè¿‡ç¬¬äºŒä¸ªå‚æ•° `setState(partialState, callback)` ä¸­çš„ `callback` æ‹¿åˆ°æ›´æ–°åçš„ç»“æœã€‚
æˆ–è€…å¯ä»¥é€šè¿‡ç»™ `setState` ä¼ é€’å‡½æ•°æ¥è¡¨ç°å‡ºåŒæ­¥çš„æƒ…å†µï¼š
  ```js
  this.setState((state) => {
      return { val: newVal }
  })
  ```
5. é‚£è¡¨ç°å‡ºå¼‚æ­¥çš„åŸç†æ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿ
åœ¨ React çš„ `setState` å‡½æ•°å®ç°ä¸­ï¼Œä¼šæ ¹æ® `isBatchingUpdates`(é»˜è®¤æ˜¯ false) å˜é‡åˆ¤æ–­æ˜¯å¦ç›´æ¥æ›´æ–° `this.state` è¿˜æ˜¯æ”¾åˆ°é˜Ÿåˆ—ä¸­ç¨åæ›´æ–°ã€‚ç„¶åæœ‰ä¸€ä¸ª `batchedUpdate` å‡½æ•°ï¼Œå¯ä»¥ä¿®æ”¹ `isBatchingUpdates` ä¸º `trueï¼Œå½“` React è°ƒç”¨äº‹ä»¶å¤„ç†å‡½æ•°ä¹‹å‰ï¼Œæˆ–è€…ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¹‹å‰å°±ä¼šè°ƒç”¨ `batchedUpdate` å‡½æ•°ï¼Œè¿™æ ·çš„è¯ï¼Œ`setState` å°±ä¸ä¼šåŒæ­¥æ›´æ–° `this.state`ï¼Œè€Œæ˜¯æ”¾åˆ°æ›´æ–°é˜Ÿåˆ—é‡Œé¢åç»­æ›´æ–°ã€‚
è¿™æ ·ä½ å°±å¯ä»¥ç†è§£ä¸ºä»€ä¹ˆåŸç”Ÿäº‹ä»¶å’Œ `setTimeout/setinterval` é‡Œé¢è°ƒç”¨ `this.state` ä¼šåŒæ­¥æ›´æ–°äº†å§ï¼Œå› ä¸ºé€šè¿‡è¿™äº›å‡½æ•°è°ƒç”¨çš„ React æ²¡åŠæ³•å»è°ƒç”¨ `batchedUpdate` å‡½æ•°å°† `isBatchingUpdates` è®¾ç½®ä¸º `true`ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™ `setState` çš„æ—¶å€™é»˜è®¤å°±æ˜¯ `false`ï¼Œé‚£ä¹ˆå°±ä¼šåŒæ­¥æ›´æ–°ã€‚

æœ€å
`setState` æ˜¯ React éå¸¸é‡è¦çš„ä¸€ä¸ªæ–¹æ³•ï¼Œå€¼å¾—å¤§å®¶å¥½å¥½å»ç ”ç©¶ä¸€ä¸‹ä»–çš„åŸç†ã€‚

å‚è€ƒæ–‡ç« 

React ä¸­ä¸ºä»€ä¹ˆè¦ bind this
ã€ŠReact çŠ¶æ€ç®¡ç†ä¸åŒæ„å®è·µã€‹